{"version":3,"sources":["common.js"],"names":[],"mappings":"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","file":"common-compiled.js","sourcesContent":["\"use strict\";\n\nvar Long = require('mongodb-core').BSON.Long,\n  Timestamp = require('mongodb-core').BSON.Timestamp;\n\n// Error codes\nvar UNKNOWN_ERROR = 8;\nvar INVALID_BSON_ERROR = 22;\nvar WRITE_CONCERN_ERROR = 64;\nvar MULTIPLE_ERROR = 65;\n\n// Insert types\nvar INSERT = 1;\nvar UPDATE = 2;\nvar REMOVE = 3\n\n\n// Get write concern\nvar writeConcern = function(target, col, options) {\n  var writeConcern = {};\n\n  // Collection level write concern\n  if(col.writeConcern && col.writeConcern.w != null) writeConcern.w = col.writeConcern.w;\n  if(col.writeConcern && col.writeConcern.j != null) writeConcern.j = col.writeConcern.j;\n  if(col.writeConcern && col.writeConcern.fsync != null) writeConcern.fsync = col.writeConcern.fsync;\n  if(col.writeConcern && col.writeConcern.wtimeout != null) writeConcern.wtimeout = col.writeConcern.wtimeout;\n\n  // Options level write concern\n  if(options && options.w != null) writeConcern.w = options.w;\n  if(options && options.wtimeout != null) writeConcern.wtimeout = options.wtimeout;\n  if(options && options.j != null) writeConcern.j = options.j;\n  if(options && options.fsync != null) writeConcern.fsync = options.fsync;\n\n  // Return write concern\n  return writeConcern;\n}\n\n/**\n * Helper function to define properties\n * @ignore\n */\nvar defineReadOnlyProperty = function(self, name, value) {\n  Object.defineProperty(self, name, {\n      enumerable: true\n    , get: function() {\n      return value;\n    }\n  });\n}\n\n/**\n * Keeps the state of a unordered batch so we can rewrite the results\n * correctly after command execution\n * @ignore\n */\nvar Batch = function(batchType, originalZeroIndex) {\n  this.originalZeroIndex = originalZeroIndex;\n  this.currentIndex = 0;\n  this.originalIndexes = [];\n  this.batchType = batchType;\n  this.operations = [];\n  this.size = 0;\n  this.sizeBytes = 0;\n}\n\n/**\n * Wraps a legacy operation so we can correctly rewrite it's error\n * @ignore\n */\nvar LegacyOp = function(batchType, operation, index) {\n  this.batchType = batchType;\n  this.index = index;\n  this.operation = operation;\n}\n\n/**\n * Create a new BulkWriteResult instance (INTERNAL TYPE, do not instantiate directly)\n *\n * @class\n * @property {boolean} ok Did bulk operation correctly execute\n * @property {number} nInserted number of inserted documents\n * @property {number} nUpdated number of documents updated logically\n * @property {number} nUpserted Number of upserted documents\n * @property {number} nModified Number of documents updated physically on disk\n * @property {number} nRemoved Number of removed documents\n * @return {BulkWriteResult} a BulkWriteResult instance\n */\nvar BulkWriteResult = function(bulkResult) {\n  defineReadOnlyProperty(this, \"ok\", bulkResult.ok);\n  defineReadOnlyProperty(this, \"nInserted\", bulkResult.nInserted);\n  defineReadOnlyProperty(this, \"nUpserted\", bulkResult.nUpserted);\n  defineReadOnlyProperty(this, \"nMatched\", bulkResult.nMatched);\n  defineReadOnlyProperty(this, \"nModified\", bulkResult.nModified);\n  defineReadOnlyProperty(this, \"nRemoved\", bulkResult.nRemoved);\n\n  /**\n   * Return an array of inserted ids\n   *\n   * @return {object[]}\n   */\n  this.getInsertedIds = function() {\n    return bulkResult.insertedIds;\n  }\n\n  /**\n   * Return an array of upserted ids\n   *\n   * @return {object[]}\n   */\n  this.getUpsertedIds = function() {\n    return bulkResult.upserted;\n  }\n\n  /**\n   * Return the upserted id at position x\n   *\n   * @param {number} index the number of the upserted id to return, returns undefined if no result for passed in index\n   * @return {object}\n   */\n  this.getUpsertedIdAt = function(index) {\n    return bulkResult.upserted[index];\n  }\n\n  /**\n   * Return raw internal result\n   *\n   * @return {object}\n   */\n  this.getRawResponse = function() {\n    return bulkResult;\n  }\n\n  /**\n   * Returns true if the bulk operation contains a write error\n   *\n   * @return {boolean}\n   */\n  this.hasWriteErrors = function() {\n    return bulkResult.writeErrors.length > 0;\n  }\n\n  /**\n   * Returns the number of write errors off the bulk operation\n   *\n   * @return {number}\n   */\n  this.getWriteErrorCount = function() {\n    return bulkResult.writeErrors.length;\n  }\n\n  /**\n   * Returns a specific write error object\n   *\n   * @return {WriteError}\n   */\n  this.getWriteErrorAt = function(index) {\n    if(index < bulkResult.writeErrors.length) {\n      return bulkResult.writeErrors[index];\n    }\n    return null;\n  }\n\n  /**\n   * Retrieve all write errors\n   *\n   * @return {object[]}\n   */\n  this.getWriteErrors = function() {\n    return bulkResult.writeErrors;\n  }\n\n  /**\n   * Retrieve lastOp if available\n   *\n   * @return {object}\n   */\n  this.getLastOp = function() {\n    return bulkResult.lastOp;\n  }\n\n  /**\n   * Retrieve the write concern error if any\n   *\n   * @return {WriteConcernError}\n   */\n  this.getWriteConcernError = function() {\n    if(bulkResult.writeConcernErrors.length == 0) {\n      return null;\n    } else if(bulkResult.writeConcernErrors.length == 1) {\n      // Return the error\n      return bulkResult.writeConcernErrors[0];\n    } else {\n\n      // Combine the errors\n      var errmsg = \"\";\n      for(var i = 0; i < bulkResult.writeConcernErrors.length; i++) {\n        var err = bulkResult.writeConcernErrors[i];\n        errmsg = errmsg + err.errmsg;\n\n        // TODO: Something better\n        if(i == 0) errmsg = errmsg + \" and \";\n      }\n\n      return new WriteConcernError({ errmsg : errmsg, code : WRITE_CONCERN_ERROR });\n    }\n  }\n\n  this.toJSON = function() {\n    return bulkResult;\n  }\n\n  this.toString = function() {\n    return \"BulkWriteResult(\" + this.toJSON(bulkResult) + \")\";\n  }\n\n  this.isOk = function() {\n    return bulkResult.ok == 1;\n  }\n}\n\n/**\n * Create a new WriteConcernError instance (INTERNAL TYPE, do not instantiate directly)\n *\n * @class\n * @property {number} code Write concern error code.\n * @property {string} errmsg Write concern error message.\n * @return {WriteConcernError} a WriteConcernError instance\n */\nvar WriteConcernError = function(err) {\n  if(!(this instanceof WriteConcernError)) return new WriteConcernError(err);\n\n  // Define properties\n  defineReadOnlyProperty(this, \"code\", err.code);\n  defineReadOnlyProperty(this, \"errmsg\", err.errmsg);\n\n  this.toJSON = function() {\n    return {code: err.code, errmsg: err.errmsg};\n  }\n\n  this.toString = function() {\n    return \"WriteConcernError(\" + err.errmsg + \")\";\n  }\n}\n\n/**\n * Create a new WriteError instance (INTERNAL TYPE, do not instantiate directly)\n *\n * @class\n * @property {number} code Write concern error code.\n * @property {number} index Write concern error original bulk operation index.\n * @property {string} errmsg Write concern error message.\n * @return {WriteConcernError} a WriteConcernError instance\n */\nvar WriteError = function(err) {\n  if(!(this instanceof WriteError)) return new WriteError(err);\n\n  // Define properties\n  defineReadOnlyProperty(this, \"code\", err.code);\n  defineReadOnlyProperty(this, \"index\", err.index);\n  defineReadOnlyProperty(this, \"errmsg\", err.errmsg);\n\n  //\n  // Define access methods\n  this.getOperation = function() {\n    return err.op;\n  }\n\n  this.toJSON = function() {\n    return {code: err.code, index: err.index, errmsg: err.errmsg, op: err.op};\n  }\n\n  this.toString = function() {\n    return \"WriteError(\" + JSON.stringify(this.toJSON()) + \")\";\n  }\n}\n\n/**\n * Merges results into shared data structure\n * @ignore\n */\nvar mergeBatchResults = function(ordered, batch, bulkResult, err, result) {\n  // If we have an error set the result to be the err object\n  if(err) {\n    result = err;\n  } else if(result && result.result) {\n    result = result.result;\n  } else if(result == null) {\n    return;\n  }\n\n  // Do we have a top level error stop processing and return\n  if(result.ok == 0 && bulkResult.ok == 1) {\n    bulkResult.ok = 0;\n\n    var writeError = {\n        index: 0\n      , code: result.code || 0\n      , errmsg: result.message\n      , op: batch.operations[0]\n    };\n\n    bulkResult.writeErrors.push(new WriteError(writeError));\n    return;\n  } else if(result.ok == 0 && bulkResult.ok == 0) {\n    return;\n  }\n\n  // Deal with opTime if available\n  if(result.opTime || result.lastOp) {\n    var opTime = result.lastOp || result.opTime;\n    var lastOpTS = null;\n    var lastOpT = null;\n\n    // We have a time stamp\n    if(opTime && opTime._bsontype == 'Timestamp') {\n      if(bulkResult.lastOp == null) {\n        bulkResult.lastOp = opTime;\n      } else if(opTime.greaterThan(bulkResult.lastOp)) {\n        bulkResult.lastOp = opTime;\n      }\n    } else {\n      // Existing TS\n      if(bulkResult.lastOp) {\n        lastOpTS = typeof bulkResult.lastOp.ts == 'number'\n          ? Long.fromNumber(bulkResult.lastOp.ts) : bulkResult.lastOp.ts;\n        lastOpT = typeof bulkResult.lastOp.t == 'number'\n          ? Long.fromNumber(bulkResult.lastOp.t) : bulkResult.lastOp.t;\n      }\n\n      // Current OpTime TS\n      var opTimeTS = typeof opTime.ts == 'number'\n        ? Long.fromNumber(opTime.ts) : opTime.ts;\n      var opTimeT = typeof opTime.t == 'number'\n        ? Long.fromNumber(opTime.t) : opTime.t;\n\n      // Compare the opTime's\n      if(bulkResult.lastOp == null) {\n        bulkResult.lastOp = opTime;\n      } else if(opTimeTS.greaterThan(lastOpTS)) {\n        bulkResult.lastOp = opTime;\n      } else if(opTimeTS.equals(lastOpTS)) {\n        if(opTimeT.greaterThan(lastOpT)) {\n          bulkResult.lastOp = opTime;\n        }\n      }\n    }\n  }\n\n  // If we have an insert Batch type\n  if(batch.batchType == INSERT && result.n) {\n    bulkResult.nInserted = bulkResult.nInserted + result.n;\n  }\n\n  // If we have an insert Batch type\n  if(batch.batchType == REMOVE && result.n) {\n    bulkResult.nRemoved = bulkResult.nRemoved + result.n;\n  }\n\n  var nUpserted = 0;\n\n  // We have an array of upserted values, we need to rewrite the indexes\n  if(Array.isArray(result.upserted)) {\n    nUpserted = result.upserted.length;\n\n    for(var i = 0; i < result.upserted.length; i++) {\n      bulkResult.upserted.push({\n          index: result.upserted[i].index + batch.originalZeroIndex\n        , _id: result.upserted[i]._id\n      });\n    }\n  } else if(result.upserted) {\n\n    nUpserted = 1;\n\n    bulkResult.upserted.push({\n        index: batch.originalZeroIndex\n      , _id: result.upserted\n    });\n  }\n\n  // If we have an update Batch type\n  if(batch.batchType == UPDATE && result.n) {\n    var nModified = result.nModified;\n    bulkResult.nUpserted = bulkResult.nUpserted + nUpserted;\n    bulkResult.nMatched = bulkResult.nMatched + (result.n - nUpserted);\n\n    if(typeof nModified == 'number') {\n      bulkResult.nModified = bulkResult.nModified + nModified;\n    } else {\n      bulkResult.nModified = null;\n    }\n  }\n\n  if(Array.isArray(result.writeErrors)) {\n    for(i = 0; i < result.writeErrors.length; i++) {\n\n      writeError = {\n          index: batch.originalZeroIndex + result.writeErrors[i].index\n        , code: result.writeErrors[i].code\n        , errmsg: result.writeErrors[i].errmsg\n        , op: batch.operations[result.writeErrors[i].index]\n      };\n\n      bulkResult.writeErrors.push(new WriteError(writeError));\n    }\n  }\n\n  if(result.writeConcernError) {\n    bulkResult.writeConcernErrors.push(new WriteConcernError(result.writeConcernError));\n  }\n}\n\n//\n// Clone the options\nvar cloneOptions = function(options) {\n  var clone = {};\n  var keys = Object.keys(options);\n  for(var i = 0; i < keys.length; i++) {\n    clone[keys[i]] = options[keys[i]];\n  }\n\n  return clone;\n}\n\n// Exports symbols\nexports.BulkWriteResult = BulkWriteResult;\nexports.WriteError = WriteError;\nexports.Batch = Batch;\nexports.LegacyOp = LegacyOp;\nexports.mergeBatchResults = mergeBatchResults;\nexports.cloneOptions = cloneOptions;\nexports.writeConcern = writeConcern;\nexports.INVALID_BSON_ERROR = INVALID_BSON_ERROR;\nexports.WRITE_CONCERN_ERROR = WRITE_CONCERN_ERROR;\nexports.MULTIPLE_ERROR = MULTIPLE_ERROR;\nexports.UNKNOWN_ERROR = UNKNOWN_ERROR;\nexports.INSERT = INSERT;\nexports.UPDATE = UPDATE;\nexports.REMOVE = REMOVE;\n"]}