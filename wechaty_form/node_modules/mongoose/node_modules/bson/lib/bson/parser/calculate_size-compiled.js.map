{"version":3,"sources":["calculate_size.js"],"names":[],"mappings":"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","file":"calculate_size-compiled.js","sourcesContent":["\"use strict\"\n\nvar writeIEEE754 = require('../float_parser').writeIEEE754\n\t, readIEEE754 = require('../float_parser').readIEEE754\n\t, Long = require('../long').Long\n  , Double = require('../double').Double\n  , Timestamp = require('../timestamp').Timestamp\n  , ObjectID = require('../objectid').ObjectID\n  , Symbol = require('../symbol').Symbol\n  , BSONRegExp = require('../regexp').BSONRegExp\n  , Code = require('../code').Code\n\t, Decimal128 = require('../decimal128')\n  , MinKey = require('../min_key').MinKey\n  , MaxKey = require('../max_key').MaxKey\n  , DBRef = require('../db_ref').DBRef\n  , Binary = require('../binary').Binary;\n\n// To ensure that 0.4 of node works correctly\nvar isDate = function isDate(d) {\n  return typeof d === 'object' && Object.prototype.toString.call(d) === '[object Date]';\n}\n\nvar calculateObjectSize = function calculateObjectSize(object, serializeFunctions, ignoreUndefined) {\n  var totalLength = (4 + 1);\n\n  if(Array.isArray(object)) {\n    for(var i = 0; i < object.length; i++) {\n      totalLength += calculateElement(i.toString(), object[i], serializeFunctions, true, ignoreUndefined)\n    }\n  } else {\n\t\t// If we have toBSON defined, override the current object\n\t\tif(object.toBSON) {\n\t\t\tobject = object.toBSON();\n\t\t}\n\n\t\t// Calculate size\n    for(var key in object) {\n      totalLength += calculateElement(key, object[key], serializeFunctions, false, ignoreUndefined)\n    }\n  }\n\n  return totalLength;\n}\n\n/**\n * @ignore\n * @api private\n */\nfunction calculateElement(name, value, serializeFunctions, isArray, ignoreUndefined) {\n\t// If we have toBSON defined, override the current object\n  if(value && value.toBSON){\n    value = value.toBSON();\n  }\n\n  switch(typeof value) {\n    case 'string':\n      return 1 + Buffer.byteLength(name, 'utf8') + 1 + 4 + Buffer.byteLength(value, 'utf8') + 1;\n    case 'number':\n      if(Math.floor(value) === value && value >= BSON.JS_INT_MIN && value <= BSON.JS_INT_MAX) {\n        if(value >= BSON.BSON_INT32_MIN && value <= BSON.BSON_INT32_MAX) { // 32 bit\n          return (name != null ? (Buffer.byteLength(name, 'utf8') + 1) : 0) + (4 + 1);\n        } else {\n          return (name != null ? (Buffer.byteLength(name, 'utf8') + 1) : 0) + (8 + 1);\n        }\n      } else {  // 64 bit\n        return (name != null ? (Buffer.byteLength(name, 'utf8') + 1) : 0) + (8 + 1);\n      }\n    case 'undefined':\n      if(isArray || !ignoreUndefined) return (name != null ? (Buffer.byteLength(name, 'utf8') + 1) : 0) + (1);\n      return 0;\n    case 'boolean':\n      return (name != null ? (Buffer.byteLength(name, 'utf8') + 1) : 0) + (1 + 1);\n    case 'object':\n      if(value == null || value instanceof MinKey || value instanceof MaxKey || value['_bsontype'] == 'MinKey' || value['_bsontype'] == 'MaxKey') {\n        return (name != null ? (Buffer.byteLength(name, 'utf8') + 1) : 0) + (1);\n      } else if(value instanceof ObjectID || value['_bsontype'] == 'ObjectID') {\n        return (name != null ? (Buffer.byteLength(name, 'utf8') + 1) : 0) + (12 + 1);\n      } else if(value instanceof Date || isDate(value)) {\n        return (name != null ? (Buffer.byteLength(name, 'utf8') + 1) : 0) + (8 + 1);\n      } else if(typeof Buffer !== 'undefined' && Buffer.isBuffer(value)) {\n        return (name != null ? (Buffer.byteLength(name, 'utf8') + 1) : 0) + (1 + 4 + 1) + value.length;\n      } else if(value instanceof Long || value instanceof Double || value instanceof Timestamp\n          || value['_bsontype'] == 'Long' || value['_bsontype'] == 'Double' || value['_bsontype'] == 'Timestamp') {\n        return (name != null ? (Buffer.byteLength(name, 'utf8') + 1) : 0) + (8 + 1);\n\t\t\t} else if(value instanceof Decimal128 || value['_bsontype'] == 'Decimal128') {\n        return (name != null ? (Buffer.byteLength(name, 'utf8') + 1) : 0) + (16 + 1);\n      } else if(value instanceof Code || value['_bsontype'] == 'Code') {\n        // Calculate size depending on the availability of a scope\n        if(value.scope != null && Object.keys(value.scope).length > 0) {\n          return (name != null ? (Buffer.byteLength(name, 'utf8') + 1) : 0) + 1 + 4 + 4 + Buffer.byteLength(value.code.toString(), 'utf8') + 1 + calculateObjectSize(value.scope, serializeFunctions, ignoreUndefined);\n        } else {\n          return (name != null ? (Buffer.byteLength(name, 'utf8') + 1) : 0) + 1 + 4 + Buffer.byteLength(value.code.toString(), 'utf8') + 1;\n        }\n      } else if(value instanceof Binary || value['_bsontype'] == 'Binary') {\n        // Check what kind of subtype we have\n        if(value.sub_type == Binary.SUBTYPE_BYTE_ARRAY) {\n          return (name != null ? (Buffer.byteLength(name, 'utf8') + 1) : 0) + (value.position + 1 + 4 + 1 + 4);\n        } else {\n          return (name != null ? (Buffer.byteLength(name, 'utf8') + 1) : 0) + (value.position + 1 + 4 + 1);\n        }\n      } else if(value instanceof Symbol || value['_bsontype'] == 'Symbol') {\n        return (name != null ? (Buffer.byteLength(name, 'utf8') + 1) : 0) + Buffer.byteLength(value.value, 'utf8') + 4 + 1 + 1;\n      } else if(value instanceof DBRef || value['_bsontype'] == 'DBRef') {\n        // Set up correct object for serialization\n        var ordered_values = {\n            '$ref': value.namespace\n          , '$id' : value.oid\n        };\n\n        // Add db reference if it exists\n        if(null != value.db) {\n          ordered_values['$db'] = value.db;\n        }\n\n        return (name != null ? (Buffer.byteLength(name, 'utf8') + 1) : 0) + 1 + calculateObjectSize(ordered_values, serializeFunctions, ignoreUndefined);\n      } else if(value instanceof RegExp || Object.prototype.toString.call(value) === '[object RegExp]') {\n          return (name != null ? (Buffer.byteLength(name, 'utf8') + 1) : 0) + 1 + Buffer.byteLength(value.source, 'utf8') + 1\n            + (value.global ? 1 : 0) + (value.ignoreCase ? 1 : 0) + (value.multiline ? 1 : 0) + 1\n      } else if(value instanceof BSONRegExp || value['_bsontype'] == 'BSONRegExp') {\n          return (name != null ? (Buffer.byteLength(name, 'utf8') + 1) : 0) + 1 + Buffer.byteLength(value.pattern, 'utf8') + 1\n            + Buffer.byteLength(value.options, 'utf8') + 1\n      } else {\n        return (name != null ? (Buffer.byteLength(name, 'utf8') + 1) : 0) + calculateObjectSize(value, serializeFunctions, ignoreUndefined) + 1;\n      }\n    case 'function':\n      // WTF for 0.4.X where typeof /someregexp/ === 'function'\n      if(value instanceof RegExp || Object.prototype.toString.call(value) === '[object RegExp]' || String.call(value) == '[object RegExp]') {\n        return (name != null ? (Buffer.byteLength(name, 'utf8') + 1) : 0) + 1 + Buffer.byteLength(value.source, 'utf8') + 1\n          + (value.global ? 1 : 0) + (value.ignoreCase ? 1 : 0) + (value.multiline ? 1 : 0) + 1\n      } else {\n        if(serializeFunctions && value.scope != null && Object.keys(value.scope).length > 0) {\n          return (name != null ? (Buffer.byteLength(name, 'utf8') + 1) : 0) + 1 + 4 + 4 + Buffer.byteLength(value.toString(), 'utf8') + 1 + calculateObjectSize(value.scope, serializeFunctions, ignoreUndefined);\n        } else if(serializeFunctions) {\n          return (name != null ? (Buffer.byteLength(name, 'utf8') + 1) : 0) + 1 + 4 + Buffer.byteLength(value.toString(), 'utf8') + 1;\n        }\n      }\n  }\n\n  return 0;\n}\n\nvar BSON = {};\n\n// BSON MAX VALUES\nBSON.BSON_INT32_MAX = 0x7FFFFFFF;\nBSON.BSON_INT32_MIN = -0x80000000;\n\n// JS MAX PRECISE VALUES\nBSON.JS_INT_MAX = 0x20000000000000;  // Any integer up to 2^53 can be precisely represented by a double.\nBSON.JS_INT_MIN = -0x20000000000000;  // Any integer down to -2^53 can be precisely represented by a double.\n\nmodule.exports = calculateObjectSize;\n"]}